---
- hosts: all
  vars:
   ansible_ssh_private_key_file: ~/.ssh/id_ed25519 
  become: true
  pre_tasks:
  
    - name: Update apt package cache
      apt:
        update_cache: yes

    - name: Upgrade all packages
      apt:
        upgrade: dist
        autoremove: yes
        autoclean: yes
    - name: Install UFW
      apt:
        name: ufw
        state: present

    - name: Enable SSH port in firewall
      ufw:
        rule: allow
        port: ssh
        
    - name: Enable firewall
      ufw:
        state: enabled

    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Install unattended-upgrades package
      apt:
        name: unattended-upgrades
        state: present

    - name: Configure unattended-upgrades
      copy:
        content: |
          // Your unattended-upgrades configuration here
        dest: /etc/apt/apt.conf.d/50unattended-upgrades
        owner: root
        group: root
        mode: 0644
      notify: Restart unattended-upgrades

  handlers:
    - name: Restart unattended-upgrades
      systemd:
        name: unattended-upgrades
        state: restarted
      become: yes

- hosts: Supervisor
  become: true
  roles:
    - Supervisor

- hosts: Employee
  become: true
  roles:
    - Employee
